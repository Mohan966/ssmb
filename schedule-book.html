!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>CDMS</title>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500">
<link href="./css/sb-admin.css" rel="stylesheet">
<link href="./css/style.css" rel="stylesheet">

<link href="./css/jquery.datetimepicker.css" rel="stylesheet">



<style>

.custom-date-style {
	background-color: red !important;
}

.input{	
}
.input-wide{
	width: 500px;
}
.form-horizontal .control-label {
	text-align:left;
}
 h1{
                 color:#248003; 
                 font-weight: bold;
                 font-style: italic;
                 }

</style>
<style type="text/css">
    table{
        
        width: 35%;
    margin: 0 auto;
    border-collapse: collapse;
    }
    table, th, td{
        border: 0px solid #cdcdcd;
    }
    table th, table td{
         padding: 1px;
        text-align: left;
    }
   
</style>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>


<div >
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/CCMS/login"><img src="./images/ccms_logo.jpg" alt=""></a>
            </div>
            <!-- Top Menu Items -->
			<b><ul class="nav navbar-left top-nav" style="font-weight:bold; font-size:large">
        <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-user"></i> User<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                         <li>
                            <a href="/CCMS/login"><i class="fa fa-fw fa-lock"></i> Home</a>
                        </li>
                        <li>
                            <a href="/CCMS/AddCCMSUser"><i class="fa fa-fw fa-user"></i> Add User</a>
                        </li>
                        <li>
                            <a href="/CCMS/ViewAllCCMSUser"><i class="fa fa-fw fa-user"></i> Update User</a>
                        </li>
                        
                      
                        <li>
                            <a href="/CCMS/LocationHome"><i class="glyphicon glyphicon-map-marker"></i> Add Location</a>
                        </li>
                        <li>
                            <a href="/CCMS/LocationUpdateView"><i class="glyphicon glyphicon-map-marker"></i> Update Location</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="/CCMS/ccmsLogout"><i class="fa fa-fw fa-power-off"></i> Log Out</a>
                        </li>
                    </ul>
                </li>
			  
			  <li class="hidden-xs"><a href="#"><i class="glyphicon glyphicon-comment"></i> About</a></li>
                   
			      <li><a href="#"><i class="glyphicon glyphicon-question-sign"></i> Help</a></li>
			       <li><a href="/CCMS/login"><i class="glyphicon glyphicon-home"></i> Home</a></li>		
      </ul></b>

			 <ul class="nav navbar-right hidden-xs">
			    <li class="brand"><img src="images/SefeLogo.jpg"></li>
			 </ul>
           </div>
           
        </nav>
         <h1 style=" text-align: center;" class="page-header">${locationName} &emsp;${locationId}&emsp; Schedule Book </h1>
        <div id="page-wrapper" style="text-align: center;">
			<div class="container-fluid">
        
     
                      <label style="font-weight: bold; font-size:large">Select Schedule Book<span class="red">*</span></label>
                     <select  name="sBook" id="sBook" style="font-weight: bold; font-size:large">
                     	<option value="0">Select</option>
                       <option value="01" >Schedule Book1</option>
                       <option value="02" >Schedule Book2</option>
                       <option value="03" >Schedule Book3</option>
                        <option value="04" >Schedule Book4</option>
                         <option value="05" >Schedule Book5</option>
                      </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div id="loading"></div>
                      <br>                             <br>  
								<table id="table" class=" table-bordered"  style="font-weight: bold; font-size:x-large">
								<thead><tr><th>Select</th><th>From Time</th><th>To Time</th><th>Status</th></tr></thead>
									<tbody>
									
										</tbody>
										</table>
	 
	 <div style="margin-top:20px;">
	<input type="button" style="font-weight: bold; font-size:large" class="btn btn-success btn-sm" id="addrow"   value="Add Row"> &emsp;&emsp;&nbsp;
	<button type="button" style="font-weight: bold; font-size:large" name="readSBook" id="readSBook" class="btn btn-info btn-sm" >Read</button>&nbsp;&nbsp;&nbsp;
	
	<button type="button" style="font-weight: bold; font-size:large" name="saveScheduleBtn" id="saveScheduleBtn" class="btn btn-success savebutton btn-sm">Save</button>&nbsp;&nbsp;&nbsp;
	
	<button type="button" style="font-weight: bold; font-size:large" name="delete-row" id="delete-row" class="btn btn-danger btn-sm" >Delete</button>
   </div>
   
   
    
   </div></div>
    
<div class="footer text-center visible-xs">
<p><img src="./images/jeneffco-logo.jpg"></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.js"></script>
<script src="./js/bootstrap.min.js"></script>

<script src="http://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
  <script src="./js/alex-date-time.js"></script>
  

<script type="text/javascript">


	/*function enableSaveButton(endTimeObject) {
		var lastToValue = endTimeObject.value;
		if(lastToValue == "23:59"){
			document.getElementById('saveScheduleBtn').disabled = false;
    	} else {
    		document.getElementById('saveScheduleBtn').disabled = true;
    	}
		return;
	}*/

	
	
	
    $(document).ready(function(){
    	
            
            $(document).on('change','#sBook',function() {
            	$('#addrow').prop('disabled', false);
                reset_table();
            });
            
           /* function enableSaveButton(){
        		document.getElementById('saveScheduleBtn').disabled = false;
        	}*/
            
            
            function reset_table()
       	 {
       	    //$('table').find('input[type="text"], select').val('');
       	    var tr = $('#table tbody tr');
       	    tr.hide();
       	 
       	    //$('#addrow').prop('disabled', true);
       	    //return;
       	 }
    	
        $("#addrow").click(function(){
   
        	var rowCount = $('#table tr').length;
        	var tbIdFrom="fdatepicker"+rowCount;
        	var tbIdTo="tdatepicker"+(rowCount);
        	var tbIdTo1="tdatepicker"+(rowCount-1);
        	var tbIdFrom1="fdatepicker"+(rowCount-1);
        	var tr = $('#table tr:last');
        	var lastToValue = $(tr).find("td").find('input.'+tbIdTo1).val();
        	var lastFromValue = $(tr).find("td").find('input.'+tbIdFrom1).val();
        	let button = document.querySelector(".savebutton");
        	
        	
        	if(lastToValue=="23:59"){
        		$('#addrow').prop('disabled', true);
        		//button.disabled = false; 
        		return;
        	}
        	
        	var time1Date= new Date("01/01/2000 "+lastToValue);
        	var time2Date= new Date("01/01/2000 "+lastFromValue);
        	    var date1 = $("#Date1").val();
        	    var date2 = $("#Date2").val();
        	
        	if(rowCount>1){
        		
        	
        	if(time1Date >= time2Date ){
        	   
        	}else{
        		alert("Please enter high time");
        		return;
        	}
        	 if(rowCount>48){
        		 
        		 return;
        	 }
        	}
           	//var markup = "<tr><td><input type='checkbox' name='record' id=record' class='record'></td><td><input type='text' maxlength='5' class='"+tbIdFrom+"' id='"+tbIdFrom+"' disabled='disabled'></td><td><input  type='text' maxlength='5' class='"+tbIdTo+"' id='"+tbIdTo+"' onblur='return enableSaveButton(this)'></td><td><select name='scode' id='scode' onchange=enableSaveButton()><option value='1' >ON</option><option value'0' >OFF</option></select></td></tr>";
           	
           	var markup = "<tr><td><input type='checkbox' name='record' id=record' class='record'></td><td><input type='text' maxlength='5' class='"+tbIdFrom+"' id='"+tbIdFrom+"' disabled='disabled'></td><td><input  type='text' maxlength='5' class='"+tbIdTo+"' id='"+tbIdTo+"'></td><td><select name='scode' id='scode' onchange=enableSaveButton()><option value='1' >ON</option><option value'0' >OFF</option></select></td></tr>";
            
           	
           	
           	
           	$("table tbody").append(markup);
            $("#"+tbIdFrom).val("00:00")
            if(rowCount>1) {
    	        var prevtbIdTo="tdatepicker"+(rowCount-1);
    		if($( "#"+prevtbIdTo ).val()+1){
    			$( "#"+tbIdFrom ).val($( "#"+prevtbIdTo ).val());
    		}
    		}
            $("#"+tbIdFrom).typeATime();
            $("#"+tbIdFrom).typeATime();
            
            if(rowCount==48){
            	button.disabled = false; 
            	$("#"+tbIdTo).val("23:59");
            }
            else{
            	$("#"+tbIdTo).typeATime();
            }
            
        });
        
        // Find and remove selected table rows
        $("#delete-row").click(function(){
        	//alert("Line 225: Removing last row");
            $("table tbody").find('input[name="record"]').each(function(){
                if($(this).is(":checked")){
                	$(this).parents("tr:last").remove();
                	//commented below line on 10/15/2022
                	//document.getElementById('saveScheduleBtn').disabled = true;
                	//Added all the below lines on 10/18/2022 -- add row has to be enabled after deleting the row, if the end value != 23:59
                	var rowCount = $('#table tr').length;
                	var tbIdFrom="fdatepicker"+rowCount;
                	var tbIdTo="tdatepicker"+(rowCount);
                	var tbIdTo1="tdatepicker"+(rowCount-1);
                	var tbIdFrom1="fdatepicker"+(rowCount-1);
                	var tr = $('#table tr:last');
                	var lastToValue = $(tr).find("td").find('input.'+tbIdTo1).val();
                	var lastFromValue = $(tr).find("td").find('input.'+tbIdFrom1).val();
                	let button = document.querySelector(".savebutton");
                	
                	
                	if(!(lastToValue=="23:59")){
                		$('#addrow').prop('disabled', false);
                		//button.disabled = false; 
                		return;
                	}
                }
                	
            });
        });
    });    

    $("#readSBook").click(function refreshText(){
    	//alert($('#sBook').val()); //uncommented on 05/25/2022
    	
    	$('#loading').html('<img width="50" height="50" src="./images/loader.gif"> <b>Please wait.... Reading the data');
    	$('#table tbody').empty();
        $.ajax({
        	 url: "/CCMS/scheduleBookRead",
        	 data:{'sBook': $('#sBook').val()},
        	 dataType:"json",
        	  success: function(jsonData){
        		  console.log('Response from Server')
        		  console.log(jsonData)
        		  $('#loading').html('');
        		  var rowCount = $('#table tr').length; 
        		   var obj = jQuery.parseJSON(jsonData);
        		  $.each(obj, function(key,value) {
        			  var tbIdFrom="fdatepicker"+rowCount;
                    	var tbIdTo="tdatepicker"+rowCount;
                    	var tbIdSelect="tbIdSelect"+rowCount;
        			  var markup = "<tr><td><input type='checkbox' name='record' id=record' class='record'></td><td><input type='text' size='5' maxlength='5' class='"+tbIdFrom+"' id='"+tbIdFrom+"' value='"+value.fromTime+"' disabled='disabled' ></td><td><input type='text' size='5' maxlength='5' class='"+tbIdTo+"' id='"+tbIdTo+"' value='"+value.toTime+"'></td><td><select  id='"+tbIdSelect+"'><option value='1' >ON</option><option value='0' >OFF</option></select></td></tr>";
                      $("table tbody").append(markup);
                      console.log(value.schBookNo);
                      //alert("line 253 value.schBookNo :"+value.schBookNo); ////added on 05/25/2022
                      $("#"+tbIdSelect+" option[value="+value.schBookNo+"]").prop('selected', true);
                      $("#"+tbIdTo).typeATime();
                      $("#"+tbIdFrom).typeATime();
                      if ( $("#"+tbIdTo).val() == "23:59"  )
					  {
						  return false;
					  }
        	   rowCount=rowCount+1;
               
        		  }); 
    	        },
    	        error:function(jsonData){
    	        	// $("#loading").hide();
    	        	
    	        	
    	        }
        });
    });
    
    $("#saveScheduleBtn").click(function(e) {
    	 e.preventDefault();
    	
    	 var TableData = []; //initialize array;

         var sEntryList=""; //empty var;
             //Here traverse and  read input/select values present in each td of each tr, ;
             var rowCount = $('table tr').length;
            // alert(rowCount);
             if ( rowCount > 1 )
            	 {
         $("table > tbody > tr").each(function(row, tr) {

          TableData[row]={
         "fromTime": $('td:eq(1) input',this).val(),
         "toTime": $('td:eq(2) input',this).val(),
         "schBookNo":  $('td:eq(3) select',this).val()
         

         };  });
		//alert("line 284 -- Tabledata[row] :"+TableData[row])
         //Convert tableData array to JsonData
         sEntryList=JSON.stringify(TableData);
         //alert("Line 287 -- converted tableData array to JsonData :"+sEntryList);
    	 console.log(sEntryList);
    	$('#loading').html('<img width="50" height="50" src="./images/loader.gif"> <b>Please wait.... Saving the data');
	    $.ajax({
	    	type: 'POST',
	        async: true,
	        url: "/CCMS/scheduleBookSave",
	        data: {'sEntryList': sEntryList,'sBook': $('#sBook').val()},
	        success: function(result) {
	        	console.log('Success response received');
	        	$('#loading').hide();
	        	$('#loading').html();
	        	console.log('loading image hidden.')
	        	
	        	setTimeout(() => {
	        		console.log('showing alert');
	        		alert('Saved Successfully');	
	        	}, 20);
	        },
	        error: function(result) {
	        	console.log('Failure response received');
	        	//$('#loading').html('');
	            //alert('error');
	        }
	    });
            	 }
             else{
            	// alert("Enter the data to save");
            	 
            	  $('#loading').html('<img width="50" height="50" src="./images/loader.gif"> <b>Enter Data to Save');
            	 
            	 setTimeout(function(){
            	       
            		 $('#loading').hide();
            	    }, 3000);
            	 
 	        	//$('#loading').html();
             }
             
	});

	</script>



</body>
</html>